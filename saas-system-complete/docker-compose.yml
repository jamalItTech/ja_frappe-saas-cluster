version: '3.8'

services:
  # ğŸŒ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Frontend)
  frontend:
    image: nginx:alpine
    container_name: saas-frontend-v1
    networks:
      workspaces_frappe-cluster-net:
        ipv4_address: 172.20.0.100
    ports:
      - "8080:80"
    volumes:
      - ./frontend:/usr/share/nginx/html
      - ./nginx/frontend.conf:/etc/nginx/conf.d/default.conf
    restart: unless-stopped

  # âš¡ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¬Ø§Ø±Ø¨ (Backend API)
  backend:
    build: ./backend
    container_name: saas-backend-v1
    networks:
      workspaces_frappe-cluster-net:
        ipv4_address: 172.20.0.101
    ports:
      - "5000:5000"
    environment:
      - FLASK_ENV=production
      - DB_HOST=172.20.0.102
      - DB_USER=root
      - DB_PASSWORD=123456
      - DB_NAME=saas_trialsv1
      - SECRET_KEY=your-secret-key-change-in-production
      - DOCKER_HOST=unix:///var/run/docker.sock
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./nginx/dynamic-conf:/etc/nginx/conf.d/dynamic
    depends_on:
      - database
    restart: unless-stopped

  # ğŸ—„ï¸ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
  database:
    image: mariadb:10.6
    container_name: saas-database-v1
    networks:
      workspaces_frappe-cluster-net:
        ipv4_address: 172.20.0.102
    environment:
      MYSQL_ROOT_PASSWORD: "123456"
      MYSQL_DATABASE: "saas_trialsv1"
    volumes:
      - saas_data-v1:/var/lib/mysql
      - ./scripts/init.sql:/docker-entrypoint-initdb.d/init.sql
    restart: unless-stopped

networks:
  workspaces_frappe-cluster-net:
    external: true

volumes:
  saas_data-v1:
