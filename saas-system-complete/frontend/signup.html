<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ - Ù…Ù†ØµØªÙ†Ø§</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="index.html">ğŸš€ Ù…Ù†ØµØªÙ†Ø§</a>
            <span class="navbar-text">
                Ø®Ø·ÙˆØ© Ù¢ Ù…Ù† Ù¢
            </span>
        </div>
    </nav>

    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card shadow-lg border-0">
                    <div class="card-body p-5">
                        <div class="text-center mb-4">
                            <h2 class="fw-bold text-primary">ğŸš€ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ</h2>
                            <p class="text-muted">Ø§Ù…Ù„Ø£ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ø¨Ø¯Ø¡ ØªØ¬Ø±Ø¨ØªÙƒ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©</p>
                        </div>
                        
                        <form id="signupForm" onsubmit="createTrialAccount(event)">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">ğŸ¢ Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ© *</label>
                                    <input type="text" class="form-control form-control-lg" name="company_name" 
                                           placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø´Ø±ÙƒØªÙƒ" required>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">ğŸ‘¤ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„ *</label>
                                    <input type="text" class="form-control form-control-lg" name="full_name" 
                                           placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„ ÙˆØ§Ù„Ø§Ø®ÙŠØ±" required>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ *</label>
                                    <input type="email" class="form-control form-control-lg" name="email" 
                                           placeholder="example@company.com" required>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                                    <input type="tel" class="form-control form-control-lg" name="phone" 
                                           placeholder="05XXXXXXXX">
                                </div>
                            </div>

                            <div class="mb-4">
                                <label class="form-label fw-bold">ğŸ” ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± *</label>
                                <input type="password" class="form-control form-control-lg" name="password" 
                                       placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚ÙˆÙŠØ©" required minlength="6">
                                <div class="form-text">
                                    ğŸ”’ ÙŠØ¬Ø¨ Ø£Ù† ØªØ­ØªÙˆÙŠ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¹Ù„Ù‰ 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„
                                </div>
                            </div>

                            <!-- Ø¹Ø±Ø¶ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© -->
                            <div class="alert alert-info">
                                <h6 class="fw-bold">ğŸ“‹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©:</h6>
                                <div id="selectedAppsDisplay" class="mb-2"></div>
                                <div class="fw-bold">â° Ù…Ø¯Ø© Ø§Ù„ØªØ¬Ø±Ø¨Ø©: <span id="trialDaysDisplay"></span> ÙŠÙˆÙ…</div>
                            </div>

                            <div class="form-check mb-4">
                                <input class="form-check-input" type="checkbox" id="agreeTerms" required>
                                <label class="form-check-label" for="agreeTerms">
                                    Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ <a href="#" class="text-decoration-none">Ø´Ø±ÙˆØ· Ø§Ù„Ø®Ø¯Ù…Ø©</a> 
                                    Ùˆ <a href="#" class="text-decoration-none">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a>
                                </label>
                            </div>

                            <button type="submit" class="btn btn-primary btn-lg w-100 py-3 fw-bold">
                                ğŸš€ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ØªØ¹Ø±ÙŠÙ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ Ø§Ù„ØµÙØ­Ø© -->
    <script>
        // ØªØ¹Ø±ÙŠÙ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
        const AVAILABLE_APPS = [
            { 
                id: 'erpnext', 
                name: 'ERPNext', 
                description: 'Ù†Ø¸Ø§Ù… ØªØ®Ø·ÙŠØ· Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„', 
                icon: 'ğŸ“Š'
            },
            { 
                id: 'hrms', 
                name: 'HRMS', 
                description: 'Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©', 
                icon: 'ğŸ‘¥'
            },
            { 
                id: 'crm', 
                name: 'CRM', 
                description: 'Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', 
                icon: 'ğŸ¤'
            },
            { 
                id: 'lms', 
                name: 'LMS', 
                description: 'Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„Ù…', 
                icon: 'ğŸ“'
            },
            { 
                id: 'website', 
                name: 'Website', 
                description: 'Ù…Ù†Ø´Ø¦ Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„ÙˆÙŠØ¨', 
                icon: 'ğŸŒ'
            }
        ];

        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª API
        const API_BASE_URL = 'http://localhost:5000';

        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 1000; min-width: 300px;';
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>
            `;
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                if (alertDiv.parentElement) {
                    alertDiv.remove();
                }
            }, 5000);
        }

        function showLoading() {
            let overlay = document.getElementById('loadingOverlay');
            if (!overlay) {
                overlay = document.createElement('div');
                overlay.id = 'loadingOverlay';
                overlay.className = 'loading-overlay';
                overlay.innerHTML = `
                    <div class="loading-spinner">
                        <div class="spinner-border" role="status">
                            <span class="visually-hidden">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
                        </div>
                        <div class="mt-2">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</div>
                    </div>
                `;
                document.body.appendChild(overlay);
            }
            overlay.style.display = 'flex';
        }

        function hideLoading() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.style.display = 'none';
            }
        }
    </script>

    <script>
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
        function loadSavedData() {
            const selectedApps = JSON.parse(localStorage.getItem('selectedApps') || '[]');
            const trialDays = localStorage.getItem('trialDays') || '14';
            
            console.log('Selected Apps from localStorage:', selectedApps);
            console.log('Trial Days from localStorage:', trialDays);
            
            const appsDisplay = document.getElementById('selectedAppsDisplay');
            const daysDisplay = document.getElementById('trialDaysDisplay');
            
            // Ø¹Ø±Ø¶ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
            if (selectedApps && selectedApps.length > 0) {
                console.log('Available Apps:', AVAILABLE_APPS);
                
                const appNames = selectedApps.map(appId => {
                    const app = AVAILABLE_APPS.find(a => a.id === appId);
                    console.log(`Looking for ${appId}:`, app);
                    return app ? `<span class="badge bg-primary me-1 mb-1">${app.name}</span>` : '';
                }).join('');
                
                appsDisplay.innerHTML = appNames;
                console.log('Rendered Apps HTML:', appNames);
            } else {
                appsDisplay.innerHTML = '<span class="text-muted">Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± ØªØ·Ø¨ÙŠÙ‚Ø§Øª</span>';
            }
            
            daysDisplay.textContent = trialDays;
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ
        async function createTrialAccount(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const data = {
                company_name: formData.get('company_name'),
                full_name: formData.get('full_name'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                password: formData.get('password'),
                selected_apps: JSON.parse(localStorage.getItem('selectedApps') || '[]'),
                trial_days: parseInt(localStorage.getItem('trialDays') || '14')
            };
console.log('API Base URL:', API_BASE_URL);

            console.log('Sending data to API:', data);

            const submitBtn = event.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            
            // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø²Ø± ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span> Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨...';
            showLoading();

            try {
                const response = await fetch(API_BASE_URL + '/api/create-trial', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                console.log(response,"responseresponse")

                const result = await response.json();
                console.log('API Response:', result);
                
                if (result.success) {
                    // ØªÙ†Ø¸ÙŠÙ localStorage
                    localStorage.removeItem('selectedApps');
                    localStorage.removeItem('trialDays');
                    
                    // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
                    showAlert(`ğŸ‰ ${result.message}`, 'success');
                    
                    // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ Ø£Ùˆ Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø±Ø§Ø¨Ø·
                    setTimeout(() => {
                        if (result.site_url) {
                            window.open(result.site_url, '_blank');
                        }
                    }, 2000);
                    
                } else {
                    showAlert(`âŒ ${result.message}`, 'danger');
                }
            } catch (error) {
                console.error('Request failed:', error);
                showAlert(`âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`, 'danger');
            } finally {
                // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ø²Ø±
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
                hideLoading();
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', loadSavedData);
    </script>
</body>
</html>
